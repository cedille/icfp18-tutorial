\documentclass[11pt]{beamer}

\usepackage{cedilleverbatim}
\usepackage{times}
\usepackage{stmaryrd}
\usepackage{MnSymbol}
\usepackage[normalem]{ulem}

\usepackage{tikz}
\usepackage{graphicx}
\usepackage{color}
\usepackage{pgflibraryarrows}
\usepackage{pgflibraryshapes}
\usepackage{pgfbaseimage}
\usepackage{listings}

\usetikzlibrary{decorations.text}

\usepackage{amsmath}
\usepackage{latexsym}
\usepackage{proof}
\usepackage{verbatim} 
\usepackage{url}

\definecolor{navy}{RGB}{0,0,128}
\definecolor{dorange}{RGB}{255,100,0}
\definecolor{dgreen}{RGB}{0,75,0}
\definecolor{dbrown}{RGB}{125,30,0}
\definecolor{lbrown}{RGB}{245,150,120}
\definecolor{ored}{RGB}{255,150,70}
\definecolor{oredd}{RGB}{255,69,0}
\definecolor{lightred}{RGB}{255,70,70}
\definecolor{vlred}{RGB}{255,170,170}
\definecolor{cream}{RGB}{255,253,208}
\definecolor{lthistle}{RGB}{185,175,185}
\definecolor{cedillecolor}{RGB}{255,100,0}
\definecolor{cedillecorecolor}{RGB}{0,128,255}

\newcommand{\mycedtext}[1]{\emph{$\texttt{{#1}}$}}
\newcommand{\semeq}[1]{\langle\hspace{-.08cm}|#1|\hspace{-0.08cm}\rangle}
\newcommand{\rep}[1]{\ulcorner #1 \urcorner}
\newcommand{\tlift}[2]{{\uparrow}_{#1}\,(#2)}
\newcommand{\dstar}[0]{\smallstar}
\newcommand{\utp}[0]{\mathcal{U}}
\newcommand{\elcap}[0]{\cap}
\newcommand{\nutt}[4]{\nu\, #1\! :\! #2 \, |\, #3.\, #4}
\newcommand{\interp}[1]{\llbracket #1 \rrbracket} 
\newcommand{\abs}[4]{{#1}\, #2\! : \! #3.\, #4}
\newcommand{\myelabframe}[2]{
\begin{itemize}
\item Classify λ-terms \\
\quad \mycedtext{\textcolor{cedillecolor}{λ x$.$ t}  $\leadsto$  \textcolor{cedillecorecolor}{λ x $:$ T$.$ t}}
{#2}
\item Insert inferred type arguments \\
\quad \mycedtext{\textcolor{cedillecolor}{id zero}  $\leadsto$  \textcolor{cedillecorecolor}{id · Nat zero}}
{#2}
\item Provide dependent type of second projection in ι\hspace{0.02cm}-pairs \\
\quad \mycedtext{\textcolor{cedillecolor}{[\! zero'$,$ zeroi\! ]} $\leadsto$ \textcolor{cedillecorecolor}{[\! zero'$,$ zeroi @ x$.$ NatI x\! ]}}
{#2}
\item Ensure β-terms supply both a term \mycedtext{u} for proving \mycedtext{\{ u $\simeq$ u \}} and one for erasure \\
\quad \mycedtext{\textcolor{cedillecolor}{β}  $\leadsto$  \textcolor{cedillecorecolor}{β<u>\{λ x$.$ x\}}}
{#2}
\item Convert δ-contradictions to Church-encoded \mycedtext{\{ tt $\simeq$ ff \}} \\
{\footnotesize \mycedtext{\textcolor{cedillecolor}{\{suc n $\simeq$ zero\}} $\leadsto$ \textcolor{cedillecorecolor}{\{suc n ff (λ \_$.$ tt) $\simeq$ zero ff (λ \_$.$ tt)\}}}}
{#2}
\item Specify where rewrites occur in ρ-terms \\
\quad \mycedtext{\textcolor{cedillecolor}{ρ e $-$ t}  $\leadsto$  \textcolor{cedillecorecolor}{ρ e @ x$.$ T\textsubscript{x} $-$ t}}
{#2}
\begin{itemize}
\item Rewriting {#1} guaranteed to preserve typeability!
{#2}
\end{itemize}
\end{itemize}
}

% unicode
\usepackage[utf8]{inputenc}
\DeclareUnicodeCharacter{2605}{\ensuremath{\star}}
\DeclareUnicodeCharacter{2081}{\ensuremath{_1}}
\DeclareUnicodeCharacter{2082}{\ensuremath{_2}}
\DeclareUnicodeCharacter{2228}{\ensuremath{\vee}}
\DeclareUnicodeCharacter{27E6}{\ensuremath{\llbracket}}
\DeclareUnicodeCharacter{27E7}{\ensuremath{\rrbracket}}
\DeclareUnicodeCharacter{228E}{\ensuremath{\uplus}}
\DeclareUnicodeCharacter{2113}{\ensuremath{\ell}}
\DeclareUnicodeCharacter{2294}{\ensuremath{\sqcup}}
\DeclareUnicodeCharacter{2192}{\ensuremath{\to}}
\DeclareUnicodeCharacter{2200}{\ensuremath{\forall}}
\DeclareUnicodeCharacter{22CE}{\ensuremath{\curlyvee}}
\DeclareUnicodeCharacter{2115}{\ensuremath{\mathbb{N}}}
\DeclareUnicodeCharacter{2238}{\ensuremath{\dotdiv}}
\DeclareUnicodeCharacter{2261}{\ensuremath{\equiv}}
\DeclareUnicodeCharacter{3BB}{\ensuremath{\lambda}}
\DeclareUnicodeCharacter{3C6}{\ensuremath{\varphi}}
\DeclareUnicodeCharacter{1D539}{\ensuremath{\mathbb{B}}}
\DeclareUnicodeCharacter{1D543}{\ensuremath{\mathbb{L}}}
\DeclareUnicodeCharacter{1D54A}{\ensuremath{\mathbb{S}}}
\DeclareUnicodeCharacter{1D54B}{\ensuremath{\mathbb{T}}}
\DeclareUnicodeCharacter{1D54D}{\ensuremath{\mathbb{V}}}
\DeclareUnicodeCharacter{D7}{\ensuremath{\times}}
\DeclareUnicodeCharacter{25C2}{\ensuremath{:}}


\mode<presentation>
{
  %\usetheme{Warsaw}
  % or ...

%\usetheme{IowaCity}
\usetheme{Boston}
%\usetheme{Savannah}

%  \setbeamercovered{transparent}
  % or whatever (possibly just delete it)
}

\usepackage[english]{babel}
% or whatever

\usepackage{times}
\usepackage[T1]{fontenc}
% Or whatever. Note that the encoding and the font should match. If T1
% does not look nice, try deleting the line with the fontenc.



\date{\ }


\begin{document}

\setbeamercolor{normal text}{bg=white,fg=black}

\begin{frame}

\begin{center}

{\Huge \texttt{cedille}}

\vspace{1cm}

{\Large \textcolor{red}{Tooling: Interactive Commands}}

\end{center}

\end{frame}




\begin{frame}
\frametitle{Interactive Commands}
\begin{itemize}
\item Backend sends all data in one batch
\pause
\item Sometimes we want more information than was given, but wouldn't be realistic to include for all nodes
\pause
\item Hence the need for ``Interactive'' Commands
\pause
\item Node Commands
\pause
\begin{itemize}
\item ``C-i n'' -- Normalize
\pause
\item ``C-i h'' -- Head-normalize
\pause
\item ``C-i e'' -- Erase
\end{itemize}
\pause
\item Beta-Reduction Commands
\pause
\begin{itemize}
\item ``C-i b'' -- Prompt for expression to open in beta-reduction buffer
\pause
\item ``C-i B'' -- Use selected node in beta-reduction buffer
\pause
\item ``C-i t'' -- Use selected node's type in beta-reduction buffer
\pause
\end{itemize}

\end{itemize}

\end{frame}



\begin{frame}
\frametitle{Interactive Commands: Beta-Reduction Buffer}
\begin{itemize}
\item Navigation commands (``f'', ``b'', ``n'', ``p'', etc...)
\pause
\item ``C-i n'' -- Normalize and replace the selected node
\item ``C-i h'' -- Head-normalize and replace the selected node
\pause
\item ``C-i r'' -- Prompt for proof of equation, and rewrite the selected node with it
\item ``C-i R'' -- Like ``C-i r'', but normalizes as it looks for matches (same as ρ+)
\pause
\item ``C-i ='' -- Prompt for expression, and replace the selected node with it if convertible
\pause
\item ``C-i ,'' -- Undo
\item ``C-i .'' -- Redo
\pause
\item ``C-i p'' -- Reconstruct a proof from each step taken so far
\pause
\end{itemize}

\end{frame}



\begin{frame}

\frametitle{Interactive Commands: One More}
\begin{itemize}
\item ``E'' -- Elaborate to Cedille Core
\end{itemize}
\end{frame}

\begin{frame}

\begin{center}

{\Huge $\leadsto$ \texttt{cedille}$_{\texttt{core}}$}

\vspace{1cm}

{\Large \textcolor{red}{Elaboration to Cedille Core}}

\end{center}

\end{frame}



\begin{frame}
\frametitle{What is Cedille Core?}

\begin{itemize}
\item Independent implementation of CDLE
\item Full annotations required
  \begin{itemize}
    \item No type inference
    \item No bidirectionality
  \end{itemize}
\item More verbose, much easier to check
\item Fewer than 1000 lines of Haskell code
\end{itemize}

\end{frame}



\begin{frame}
\frametitle{\textcolor{cedillecolor}{Cedille} vs. \textcolor{cedillecorecolor}{Cedille Core}}

\hspace{0.5cm}
\begin{tikzpicture}

\path (0,0) node[very thick,cedillecolor,ellipse,draw,inner xsep=100pt,inner ysep=70pt](cedille){} ;
%\path (-5,-3) node[right]{\textcolor{cedillecolor}{Cedille}} ;

\path (-1.8,2.2) node {\mycedtext{(λ x $:$ T$.$ t)}} ;
\path (1,2.9) node {\mycedtext{(λ x$.$ t)}} ;
\path (2.2,2.2) node {\mycedtext{[ t\textsubscript{1}$,$ t\textsubscript{2} ]}} ;
\path (-1,-0.3) node {\mycedtext{[ t\textsubscript{1}$,$ t\textsubscript{2} @ x$.$ T\textsubscript{x} ]}} ;
\path (4,-0.1) node {\mycedtext{ε}} ;
\path (0,1.7) node {\mycedtext{δ}} ;
\path (-2,1) node {\mycedtext{(ρ e @ x$.$ T\textsubscript{x} $-$ t)}} ;
\path (2.3,0.7) node {\mycedtext{β}} ;
\path (-3,-1.8) node {\mycedtext{(β<u\textsubscript{T}>)}} ;
\path (2.5,-0.4) node {\mycedtext{(β\{u\textsubscript{t}\})}} ;
\path (-3.3,0.3) node {\mycedtext{(β<u\textsubscript{T}>\{u\textsubscript{t}\})}} ;
\path (1.5,0.7) node {\mycedtext{φ}} ;
\path (-2,-2.4) node {\mycedtext{(ρ e $-$ t)}} ;
\path (1.5,-1.6) node {\mycedtext{(ρ<3\;4\;6> e $-$ t)}};
\path (2.5,-1) node {\mycedtext{χ}} ;
\path (0,-1) node {\mycedtext{ς}} ;
\path (-0.5,-2) node {\mycedtext{θ}} ;
\path (0.6,-2.7) node {\tiny{$Type$-$Argument \ Inference$}} ;
\path (2.9,1.3) node {\tiny{$Type \ Checking$}} ;
\path (-2,-1) node {\tiny{$Type \ Synthesis$}} ;
\path (2.8,0.2) node {\tiny{$Scope \ Shadowing$}} ;

\pause

\path (-1.43,0.7) node[very thick,cedillecorecolor,ellipse,draw,inner xsep=65pt,inner ysep=45pt](cedillecore){} ;
%\path (-5,-3.5) node[right]{\textcolor{cedillecorecolor}{Cedille Core}} ;

\end{tikzpicture}

\end{frame}



\begin{frame}
\frametitle{\textcolor{cedillecolor}{Cedille} $\leadsto$ \textcolor{cedillecorecolor}{Cedille Core}}
\myelabframe{is \uline{not}}{\pause}
\end{frame}



%\begin{frame}
%\frametitle{Type-Preserving Rewrites: Problem A}
%
%\begin{itemize}
%\item Terms in equality types are untyped
%\item Rewriting is performed by top-down $\beta\eta$-substitution
%\item We need add classifiers to λ-terms in checking positions, when elaborating
%\end{itemize}

%\end{frame}



\begin{frame}
\frametitle{Type-Preserving Rewrites: Problem A}
\begin{center}
\vspace{-1.22cm}
%\textit{\textcolor{darkgray}{Context}}
\mycedtext{\textcolor{darkgray}{Context}}

\mycedtext{\textcolor{darkgray}{
\uline{A} $:$ $\star$ \quad
\uline{B} $:$ A $\rightarrow$ $\star$ \quad
\uline{a} $:$ A \quad
\uline{e} $:$ \{ a $\simeq$ λ x$.$ x x \}}}

\vspace{1.25cm}

\mycedtext{
\textcolor{cedillecolor}{ρ e $-$ λ b$.$ b} $\Leftarrow$ (B a $\rightarrow$ B a)}

\vspace{0.3cm}
\quad $\leadsto$
\vspace{0.3cm}

\mycedtext{\textcolor{cedillecorecolor}{
\hspace{-20pt}
ρ e @ x$.$ (B x $\rightarrow$ B x) $-$}}

\mycedtext{\textcolor{cedillecorecolor}{
λ b $:$ B \textcolor{red}{(λ x$.$ x x)}$.$ b}}

\vspace{0.5cm}
\mycedtext{\textcolor{red}{(λ x$.$ x x) $\Rightarrow$ ???}}

\end{center}

\end{frame}



\begin{frame}
\frametitle{Type-Preserving Rewrites: Solution A}
\begin{center}
\vspace{-1.25cm}
\mycedtext{\textcolor{darkgray}{Context}}

\mycedtext{\textcolor{darkgray}{
\uline{A} $:$ $\star$ \quad
\uline{B} $:$ A $\rightarrow$ $\star$ \quad
\uline{a} $:$ A \quad
\uline{e} $:$ \{ a $\simeq$ λ x$.$ x x \}}}

\vspace{1.25cm}

\mycedtext{
\textcolor{cedillecolor}{ρ e $-$ λ b$.$ b} $\Leftarrow$ (B a $\rightarrow$ B a)}

\vspace{0.3cm}
\quad $\leadsto$
\vspace{0.3cm}

\mycedtext{\textcolor{cedillecorecolor}{
\hspace{-60pt}
ρ e @ x$.$ (B x $\rightarrow$ B x) $-$}}

\mycedtext{\textcolor{cedillecorecolor}{
\hspace{10pt}
λ b $:$ B (\uline{φ e $-$ a \{λ x$.$ x x\}})$.$ b}}

\vspace{0.5cm}
\quad

\end{center}

\end{frame}
%\begin{frame}
%\frametitle{Type-Preserving Rewrites: Solution A}

%\begin{itemize}
%\item \mycedtext{φ p $-$ t \{u\}} uses the type of \mycedtext{t} but the erasure of \mycedtext{u}
%\begin{itemize}
%\item \mycedtext{p} must prove \mycedtext{\{ t $\simeq$ u \}}
%\end{itemize}
%\item In Problem A, rewrite \mycedtext{B a} \:to \mycedtext{B (φ e $-$ a \{λ x$.$ x x\})}
%\end{itemize}
%
%\end{frame}



\begin{frame}
\frametitle{Type-Preserving Rewrites: Problem B}
\begin{center}
\mycedtext{\textcolor{darkgray}{Context}}

\mycedtext{\textcolor{darkgray}{
\uline{A} $:$ $\star$ \quad
\uline{B} $:$ (\textcolor{gray}{\small $\Pi$} y $:$ A$.$ \textcolor{gray}{\small $\Pi$} z $:$ A$.$ \{ y $\simeq$ z (λ x$.$ x) \} $\rightarrow$ $\star$)}}

\mycedtext{\textcolor{darkgray}{\uline{a} $:$ A \quad \uline{a'} $:$ A}}

\mycedtext{\textcolor{darkgray}{
\uline{e} $:$ \{ a $\simeq$ a' (λ x$.$ x) \} \quad
\uline{p} $:$ \{ a $\simeq$ λ x$.$ x \}}}

\vspace{1.25cm}

\mycedtext{
\textcolor{cedillecolor}{ρ p $-$ λ b$.$ b} $\Leftarrow$ (B a a' e $\rightarrow$ B a a' e)}

\vspace{0.3cm}
\quad $\leadsto$
\vspace{0.3cm}

\mycedtext{\textcolor{cedillecorecolor}{
ρ p @ x$.$ (B x a' e $\rightarrow$ B x a' e) $-$ \qquad}}

\mycedtext{\textcolor{cedillecorecolor}{
λ b $:$ B (φ p $-$ a \{λ x$.$ x\}) a' \textcolor{red}{e}$.$ b}}

\vspace{0.75cm}
\mycedtext{\textcolor{red}{e $\Rightarrow$ \{ a $\simeq$ a' (λ x$.$ x) \}}}

\mycedtext{\textcolor{red}{e $\nRightarrow$ \{ λ x$.$ x $\simeq$ a' (λ x$.$ x) \}}}

\end{center}

\end{frame}



%\begin{frame}
%\frametitle{Type-Preserving Rewrites: Solutions A \& B }
%
%\begin{itemize}
%\item \mycedtext{φ p $-$ t \{u\}} uses the type of \,\mycedtext{t}\, but the erasure of \,\mycedtext{u}
%\begin{itemize}
%\item \mycedtext{p}\, must prove \mycedtext{\{ t $\simeq$ u \}}
%\end{itemize}
%\item In Problem B, rewrite \mycedtext{B\!\! a\!\! a'\!\! e} to \mycedtext{B\!\! (φ\!\! e\!\! $-$\!\! a\!\! \{λ x$.$ x\})\!\! a'\!\! e}
%\item We also need to rewrite \textit{back} the expected types of dependent term arguments
%\begin{itemize}
%\item To generate a rewrite guide (\mycedtext{@ x$. \ ...$}) we pretend \,\mycedtext{x}\, is the right-hand side of the equation
%\item We rewrite first to \,\mycedtext{x}, checking if any term arguments in the type are dependent upon a rewritten one, by simply checking if \,\mycedtext{x}\, is a free variable in the expected type of the argument
%\item The subterm is checked against the rewritten type, with the proper right-hand side substituted for \,\mycedtext{x}
%\item We don't want do rewrite too much; conveniently, using \,\mycedtext{ρ ς [proof] @ x$.$ [arg type] $- \ ...$}\, only rewrites precisely where we want due to the nature of scoping!
%\end{itemize}
%\end{itemize}
%
%\end{frame}



\begin{frame}
%\frametitle{Type-Preserving Rewrites: In Action}
\frametitle{Type-Preserving Rewrites: Solution B}
\begin{center}
\vspace{0.25cm}

\mycedtext{\textcolor{darkgray}{Context}}

\mycedtext{\textcolor{darkgray}{
\uline{A} $:$ $\star$ \quad
\uline{B} $:$ (\textcolor{gray}{\small $\Pi$} y $:$ A$.$ \textcolor{gray}{\small $\Pi$} z $:$ A$.$ \{ y $\simeq$ z (λ x$.$ x) \} $\rightarrow$ $\star$)}}

\mycedtext{\textcolor{darkgray}{\uline{a} $:$ A \quad \uline{a'} $:$ A}}

\mycedtext{\textcolor{darkgray}{
\uline{e} $:$ \{ a $\simeq$ a' (λ x$.$ x) \} \quad
\uline{p} $:$ \{ a $\simeq$ λ x$.$ x \}}}

\vspace{1.25cm}

\mycedtext{
\textcolor{cedillecolor}{ρ p $-$ λ b$.$ b} $\Leftarrow$ (B a a' e $\rightarrow$ B a a' e)}

\vspace{0.3cm}
\quad $\leadsto$
\vspace{0.3cm}

\mycedtext{\textcolor{cedillecorecolor}{ρ p @ x$.$ (B x a' e $\rightarrow$ B x a' e) $-$ \hspace{70pt}}}

\mycedtext{\textcolor{cedillecorecolor}{λ b $:$ B (φ p $-$ a \{λ x$.$ x\}) a'\hspace{80pt}}}

\mycedtext{\textcolor{cedillecorecolor}{\hspace{60pt}(\uline{ρ ς p @ x$.$ \{ x $\simeq$ a' (λ x$.$ x) \} - e)$.$}}}

\mycedtext{\textcolor{cedillecorecolor}{b\hspace{231pt}}}

\vspace{0.75cm}

\quad

\end{center}

\end{frame}


\begin{frame}
\frametitle{\textcolor{cedillecolor}{Cedille} $\leadsto$ \textcolor{cedillecorecolor}{Cedille Core}\textcolor{white}{Invisible}}
\myelabframe{\uline{is}}{}

\end{frame}

\end{document}
